
<!doctype html>
<html>
<head>
	<meta charset='utf-8' />
	<title>Infographic Demo</title>
	<script src="//droid-sans.js"></script>
	<script src="//neuton.js"></script>

		<style>			
		
			body {
				font-family: droid-sans, sans-serif; 
				font-family: neuton, serif; 
			}	
			
			em {
				color: red;
			}
			
			#logo {
				background-image: url('logo.jpg'); 
				background-repeat: no-repeat; 				
				background-size: contain;
				position: fixed;
				width: 64px;
				height: 64px;
				left: 100%;
				top: 100%;
				margin-top: -64px;
				margin-left: -64px;
			}
			
			#container {
				margin-top: -125px;
				width: 100%;
				height: 700px;
				text-align: center;
			}
			
			#instructions {
				font-family: droid-sans, sans-serif; 
				width: 400px;
				text-align: left; 
				position: relative;
				top: 150px;
				left: 150px;
			}
			
			#popup {
				font-family: droid-sans, sans-serif; 
				background-color: white;
				border: 2px solid red;
				text-align: center;
				position: absolute;
				width: 100px;
			}
			
			canvas {					
				position: relative;
				padding-top: 0px;
				margin-top: 0px;
				background-image: url('diagram.png'); 
				background-repeat: no-repeat; 
				background-position: 7px 6px; /* mistakes were made, this is a one off adjustment that normally wouldn't need to be made, but hey, fine tuning is a nice thing to have */
			}
		</style>
</head>
<body class='no-js'>
	<h1>Infographic Demo</h1>
	<p>This filler text is pretty much just here to make sure that the html 5 infographic below behaves nicely with other html elements on the page.</p>
	<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae quam eget quam aliquet commodo vitae efficitur eros. Maecenas venenatis sit amet nunc a finibus. Morbi quam magna, finibus at ante a, scelerisque dignissim turpis. Fusce eros dui, suscipit in accumsan a, molestie a tortor. Nam sit amet quam quis eros elementum dictum non non dui. Proin quis enim egestas, sagittis diam non, pharetra turpis. Quisque eget justo ut erat sodales mattis eu non tortor. Quisque euismod justo in imperdiet ultricies. Nam porttitor orci vel nibh aliquam sagittis. Etiam laoreet convallis risus eu tincidunt. Nam lorem augue, congue at porttitor quis, sodales pulvinar sem. Integer suscipit viverra ante, sed cursus nulla vestibulum eu. Nam eu ligula sed justo varius vestibulum sed vel ante. Sed interdum sagittis nisi, vitae placerat justo. Nullam id sapien et metus faucibus euismod sit amet in urna. Aenean ullamcorper velit ut leo tempus, in viverra justo auctor.</p>
	
	
	<div id="container">
		<div id="popup">This here's a popup ya'll</div>
		<div id="instructions">
			<p><em>Roll-over the coloured blocks</em> to see examples of learning outcomes that generally match each of the various combinations of the cognitive process and knowledge dimensions.</p>
			<p>NOTE: These are learning outcomes - not learning activities. Learning activities are derived from the learning outcomes. It is useful to precede each objective with something like, "students will be able to..."</p>
		</div>
		<canvas id="canvas" width=800 height=700></canvas>		
	</div>
	
	<div id="logo"></div>
	
	<script src='./JSHotspotToolkit/lib/dollardom.min.js'></script>	
	<script src='./JSHotspotToolkit/lib/Mouse.js'></script>
	
	<script>
		$dom.onready(init);
		
		var polys = [];
		var paths = [[],[],[],[],[],[]];
		
		polys = // grid-aligned polys, generated using draw_polygons tool and re-indexed using poly_array_indexer tool
		[[[[491,9],[432,33],[431,49],[490,81],[547,52],[548,34],[491,9]],[[611,83],[547,51],[490,79],[490,98],[555,133],[609,100],[611,83]],[[553,150],[554,131],[607,101],[679,136],[674,153],[620,188],[553,150]],[[693,249],[617,206],[619,186],[673,152],[752,194],[724,296],[673,336],[693,249]]],[[[371,78],[372,94],[426,129],[490,99],[489,78],[429,49],[371,78]],[[489,184],[427,148],[427,127],[490,98],[554,130],[553,151],[489,184]],[[557,244],[486,203],[487,184],[552,150],[619,187],[618,207],[557,244]],[[630,312],[553,264],[556,244],[618,205],[692,249],[673,335],[617,382],[630,312]]],[[[303,126],[303,144],[362,181],[427,148],[426,128],[373,95],[303,126]],[[421,240],[363,201],[362,180],[427,147],[485,183],[488,206],[421,240]],[[489,306],[419,260],[421,238],[489,204],[552,241],[557,244],[554,264],[489,306]],[[560,379],[486,324],[489,304],[553,263],[629,311],[616,380],[556,426],[560,379]]],[[[362,201],[289,237],[234,195],[233,179],[304,143],[362,180],[362,201]],[[351,303],[290,255],[289,234],[362,199],[422,238],[420,259],[351,303]],[[415,370],[347,318],[349,303],[418,258],[488,306],[487,325],[415,370]],[[487,448],[414,388],[414,368],[484,325],[559,378],[555,428],[485,482],[487,448]]],[[[212,297],[160,251],[158,233],[233,196],[289,235],[290,255],[212,297]],[[271,367],[212,314],[210,296],[288,254],[350,303],[349,320],[271,367]],[[336,442],[271,386],[269,366],[348,321],[415,371],[415,388],[336,442]],[[407,540],[407,525],[338,459],[337,440],[412,389],[485,445],[485,481],[407,540]]],[[[139,411],[95,362],[76,292],[159,252],[211,298],[212,317],[130,361],[139,411]],[[194,468],[137,410],[130,361],[212,316],[270,365],[271,385],[189,435],[194,468]],[[252,533],[192,467],[188,433],[268,385],[335,441],[337,462],[253,518],[252,533]],[[321,609],[251,533],[252,516],[340,461],[406,523],[406,542],[321,609]]]]
			
		function makePath(poly) {
			var path = new Path2D;
			path.moveTo(poly[0][0], poly[0][1]);
			
			for(var i = 1; i < poly.length; i++) {
				path.lineTo(poly[i][0], poly[i][1]);
			}
			
			return path;
		}
		
		function drawPoly(coordList) {
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");			
			var path = makePath(coordList);			
			ctx.stroke(path);
		}
		
		function drawPath(path) {
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");			
			ctx.stroke(path);
		}
		
		var rolloverContext = null;
		
		function rollover(path) {				
			var canvas = document.getElementById("canvas");
						
			if(rolloverContext === null) 
			{
				rolloverContext = canvas.getContext('2d');
				rolloverContext.fillStyle = "rgba(0, 0, 0, 0.10)";
			}
			rolloverContext.save();
			rolloverContext.clip(path);
			rolloverContext.fillRect(0, 0, canvas.width, canvas.height);
			rolloverContext.restore();			
		}
		
		function doPopUp(x, y) {
			var popup = $dom.get("#popup")[0];
			popup.innerHTML = "Lorem ipsum dolor sit amet,.";
			popup.x = x - 50;
			popup.top = y - 150 ;
			
		}
		
		
		function preprocessPaths () {		
			for(var i = 0; i < polys.length; i++) {							
				for(var j = 0; j < polys[i].length; j++) {							
					var path = makePath(polys[i][j]);		
					paths[i][j] = path;						
				}
			}		
		}
		
		
		function init() {
		
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");			
			
			preprocessPaths();
			
			var checkRollover = function(x, y) {
				for(var i = 0; i < paths.length; i++) {			
					for(var j = 0; j < paths[i].length; j++) {					
						if(ctx.isPointInPath(paths[i][j], x, y)) {
							return { x: i, y: j };
						}
					}
				}				
				return null;
			}
			
			var lastPath = { x: -1, y: -1 };
			
			mouse.on('move', null, function (e) { 					
				var rollover = checkRollover(e.offsetX, e.offsetY);				
				if(rollover !== null) {
					if(lastPath.x == rollover.x && lastPath.y == rollover.y) return;
					render();
					lastPath = rollover;
					fillOutside(rollover.x, rollover.y);
				} else {
					lastPath = { x: -1, y: -1 };
					render();
				}
			});
			
			var drawRow = function (row) {	
					ctx.lineWidth =1;
					
					for(var i = 0; i < paths[row].length; i++) {
						var path = paths[row][i];
						ctx.stroke(path);
						ctx.save();
						ctx.fillStyle = "rgba(0, 0, 0, 0.10)";
						ctx.clip(path);
						ctx.fillRect(0, 0, canvas.width, canvas.height);
						ctx.restore();
					}
			}
			
			// TODO: consider implications of this algorithm assuming a square array of polys
			var drawCol = function (col) {	
					ctx.lineWidth =1;
					ctx.strokeStyle ="rgba(0, 0, 0, 0.10)";				
					for(var i = 0; i <= paths[0].length + 1; i++) { // TODO: wat
						var path = paths[i][col];
						ctx.stroke(path);
						ctx.save();
						ctx.fillStyle = "rgba(0, 0, 0, 0.10)";
						ctx.clip(path);
						ctx.fillRect(0, 0, canvas.width, canvas.height);
						ctx.restore();
					}
			}
			
			var fillOutside = function (row, col) {
			
				for(var i = row; i < paths.length; i++) {			
					for(var j = col; j < paths[i].length; j++) {		
						if(i != row && j != col) {
							var path = paths[i][j];
							ctx.save();
							ctx.fillStyle = "rgba(0, 0, 0, 0.10)";
							ctx.clip(path);
							ctx.fillRect(0, 0, canvas.width, canvas.height);
							ctx.restore();
						}
					}
				}			
				
				for(var i = 0; i < paths.length; i++) {			
					for(var j = 0; j < paths[i].length; j++) {		
						if(i < row || j < col) {
							var path = paths[i][j];
							ctx.save();
							ctx.fillStyle = "rgba(0, 0, 0, 0.10)";
							ctx.clip(path);
							ctx.fillRect(0, 0, canvas.width, canvas.height);
							ctx.restore();
						}
					}
				}
			}
			
			
			mouse.on('click', 'left', function (e) {			
			console.log("click");		
				var rollover = checkRollover(e.offsetX, e.offsetY);				
				if(rollover !== null) {
				//	if(lastPath.x == rollover.x && lastPath.y == rollover.y) return;
					
					doPopUp(e.offsetX, e.offsetY);
				}	
			});
			
			var render = function () {
				ctx.clearRect(0, 0, canvas.width, canvas.height);	
				/* do whatever re-rendering might need to be done here */
				ctx.strokeStyle = "#111";
				ctx.lineWidth = 2;
				for(var i = 0; i < paths.length; i++) {			
					for(var j = 0; j < paths[i].length; j++) {		
							var path = paths[i][j];
							drawPath(path);
					}
				}
			}
			
			render();
			//window.setInterval(render, 0.1);
		}
	</script>
</body>
</html>
